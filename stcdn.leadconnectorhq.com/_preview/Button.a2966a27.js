import{d as at,r as v,n as rt,o as nt,a as y,c as _,s as Oe,b as k,i as b,t as N,e as $,w as U,v as Le,x as Re,y as Ne,h as Ce,F as ot,A as ue,B as ce,m as B,C as st,j as lt}from"./entry.7a41e7c5.js";import{m as oe,y as it,z as ut,A as H,w as Ae}from"./helpers.50520399.js";import{_ as ct}from"./MoonLoader.vue.521f3212.js";import{u as dt,a as h,E as V,b as pt}from"./index.95960bb2.js";import{f as vt}from"./funnel_event_helper.c4317f7c.js";import{a as K,g as J,b as X,d as mt}from"./Attributions.a88a0b8c.js";import{F as De}from"./FunnelServices.5a3a982b.js";import{P as C,O as ft}from"./PaymentServices.973e92ac.js";import{c as yt}from"./orderform_helpers.3e3258d7.js";import{u as ht}from"./index.7728e541.js";import{A as se,N as le}from"./HLConst.f48fdde4.js";import"./index.f268050a.js";import"./HLImage.vue.9b6d9fa8.js";import"./client-only.145cbe4d.js";import"./HtmlPreview.vue.b5168484.js";import"./currency_helper.4623e3e9.js";var de={};Object.defineProperty(de,"__esModule",{value:!0});function Z(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Z=function(t){return typeof t}:Z=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(s)}var $e="https://js.stripe.com/v3",gt=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Fe="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",_t=function(){for(var t=document.querySelectorAll('script[src^="'.concat($e,'"]')),n=0;n<t.length;n++){var i=t[n];if(gt.test(i.src))return i}return null},bt=function(t){var n=t&&!t.advancedFraudSignals?"?advancedFraudSignals=false":"",i=document.createElement("script");i.src="".concat($e).concat(n);var d=document.head||document.body;if(!d)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return d.appendChild(i),i},wt=function(t,n){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"1.54.2",startTime:n})},Y=null,Pt=function(t){return Y!==null||(Y=new Promise(function(n,i){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe&&t&&console.warn(Fe),window.Stripe){n(window.Stripe);return}try{var d=_t();d&&t?console.warn(Fe):d||(d=bt(t)),d.addEventListener("load",function(){window.Stripe?n(window.Stripe):i(new Error("Stripe.js not available"))}),d.addEventListener("error",function(){i(new Error("Failed to load Stripe.js"))})}catch(w){i(w);return}})),Y},St=function(t,n,i){if(t===null)return null;var d=t.apply(void 0,n);return wt(d,i),d},Me=function(t){var n=`invalid load parameters; expected object of shape

    {advancedFraudSignals: boolean}

but received

    `.concat(JSON.stringify(t),`
`);if(t===null||Z(t)!=="object")throw new Error(n);if(Object.keys(t).length===1&&typeof t.advancedFraudSignals=="boolean")return t;throw new Error(n)},Q,ie=!1,Ue=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ie=!0;var d=Date.now();return Pt(Q).then(function(w){return St(w,n,d)})};Ue.setLoadParameters=function(s){if(ie&&Q){var t=Me(s),n=Object.keys(t),i=n.reduce(function(d,w){var A;return d&&s[w]===((A=Q)===null||A===void 0?void 0:A[w])},!0);if(i)return}if(ie)throw new Error("You cannot change load parameters after calling loadStripe");Q=Me(s)};de.loadStripe=Ue;var It=de;const Et=ue(()=>ce(()=>import("./Recaptcha.efee0035.js"),[],import.meta.url).then(s=>s.default||s)),xt=ue(()=>ce(()=>import("./NewPaypalSmartBtnSubscription.d79cec6f.js"),["./NewPaypalSmartBtnSubscription.3a186e73.css"],import.meta.url).then(s=>s.default||s)),kt=ue(()=>ce(()=>import("./NewPaypalSmartBtnOrder.fe5d1b2c.js"),["./NewPaypalSmartBtnSubscription.3a186e73.css"],import.meta.url).then(s=>s.default||s)),Tt=["id","href","target","aria-label"],Ot={key:0,style:{"margin-right":"5px"},class:"button-icon-start"},Lt={class:"main-heading-button"},Rt={key:1,style:{"margin-left":"5px"},class:"button-icon-end"},Nt={class:"sub-heading-button"},Ct={key:1,class:"recaptcha-container button-recaptcha-container"},At={key:0},Dt=["disabled","id","aria-label"],Ft={key:0,class:"button-icon-start"},Mt={class:"main-heading-button"},$t={key:1,class:"button-icon-end"},Ut={class:"sub-heading-button"},Bt={class:"btn-loader-position",style:{left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)"}},Vt={key:3,style:{width:"70%",margin:"auto"},class:"paypal-content"},Wt={key:4,class:"card-el-error-msg error-message",style:{"justify-content":"center"}},jt={inheritAttrs:!1},sa=at({...jt,__name:"Button",props:{element:{type:Object,required:!0},classStyles:{type:Array,required:!0}},setup(s){var Pe,Se,Ie,Ee,xe,ke,Te;const t=s,n=ht(),{openPopup:i}=pt(),{call:d,createMembershipToken:w,mailTo:A,sms:Be,goToNextFunnelStep:D,openUrl:ee,getNextFunnelStepURL:Ve}=dt(),We=lt(),{$bus:pe}=We;let T=(Se=(Pe=t.element.extra)==null?void 0:Pe.text)==null?void 0:Se.value;T=oe(T);let O=(Ee=(Ie=t.element.extra)==null?void 0:Ie.subText)==null?void 0:Ee.value;O=oe(O);const je=n.value.funnelId,Ge=n.value.stepId,ze=n.value.funnelPageId,p=n.value.locationId,P=(Te=(ke=(xe=t.element.extra)==null?void 0:xe.productId)==null?void 0:ke.value)==null?void 0:Te.id,ve=v("avascript: void(0)"),u=v(!1),te=v(!1),me=v(""),fe=v(""),ae=v(),re=v(!1),ye=v(""),W=v(""),S=v(""),g=v(!1),qe=rt(()=>{var e;return((e=ae.value)==null?void 0:e.price.type)==="recurring"}),m=v(),f=v(""),j=v(!1),L=v(),F=v(""),he=()=>{const{action:{value:e}}=t.element.extra,a=(T??"")+" "+(O??"");if(T||O)return a;if(e===h.GO_TO_URL){const{visitWebsite:{value:r}}=t.element.extra;return r==null?void 0:r.url}return a},He=e=>{if(!e){F.value="Verification failed! Please try again";return}F.value="",L.value=e};nt(()=>{const{action:{value:e}}=t.element.extra;if(e===h.GO_TO_NEXT_STEP||e===h.SELL_PRODUCT){const a=n.value.funnelDomain,r=n.value.funnelNextPageId;a?ve.value=`https://${a}${n.value.funnelNextStep}`:r&&(ve.value=`https://${window.location.host}/v2/preview/${r}`)}(e===h.CLICK_TO_CALL||e===h.CLICK_TO_SMS||e===h.GO_TO_URL||e===h.GO_TO_STEP)&&(te.value=!0,me.value=Qe()),n.value.orderFormVersion===2&&P&&e===h.SELL_PRODUCT&&Ke()});async function Ke(){var e,a,r;try{const o=await De.findProductById({productId:P});ae.value={...o,qty:1,amount:o.price.amount},W.value=(e=o==null?void 0:o.price)==null?void 0:e.currency}catch(o){const l=((r=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:r.message)||(o==null?void 0:o.message)||"Not able to fetch products!";console.error(l),alert("Not able to fetch products!")}}async function Je(){n.value.videoExistsInPage&&pe.$emit("handle-redirect")}async function Xe(){const{action:e}=t.element.extra;switch(e.value){case"openPopup":{i();break}case"url":{const{visitWebsite:a}=t.element.extra;ee(a.value);break}case"hide-element":{const{hideElements:a}=t.element.extra;ut(a.value);break}case"show-element":{const{showElements:a}=t.element.extra;it(a.value);break}case"scroll-to-element":{const{scrollToElement:a}=t.element.extra;pe.$emit("scroll-to-element",a.value);break}case"go-to-next-funnel-step":{u.value=!0,D();break}case h.GO_TO_STEP:{u.value=!0,D(t.element.extra.stepPath.value);break}case"sell-product":{if(u.value)return;if(u.value=!0,n.value.orderFormVersion===2)if(B("provider").value==="pp")re.value=!0;else{if(n.value.defaultPaymentProvider===se&&n.value.merchantLoginId){ge(se);return}else if(n.value.defaultPaymentProvider===le&&n.value.nmiMerchantGatewayId){ge(le);return}const a=n.value.stripePublishableKey,r=n.value.stripeAccountId,o=n.value.stripePublishableKey;if(a&&o)ye.value=await It.loadStripe(a,{stripeAccount:r||void 0});else{alert("Stripe account not found!");return}Ye()}else Ze();break}case"click-to-call":{const a=t.element.extra;d(a[V.PHONE_NUMBER].value);break}case"click-to-sms":{const a=t.element.extra;Be(a[V.PHONE_NUMBER].value);break}case"click-to-mail":{const a=t.element.extra;A(a[V.EMAIL_ADDRESS].value);break}case h.GO_TO_MEMBERSHIP:{try{let a;const r=n.value.locationId,{ct:o,previewUrl:l}=B(`_mf_${r}`).value;location.hostname==="localhost"?a=`http://localhost:4040/library/?domain=${l}&token=${o}&location_id=${r}`:a=`${l}/library?&token=${o}&location_id=${r}`,ee({url:a,newTab:!1})}catch{alert("Sorry something went wrong.")}break}default:console.error(`Invalid action type received: ${e.value}`)}}function G(e){var a,r;try{const o=e==null?void 0:e.membershipPurchase;o!=null&&o.length&&w(p,o[0].token);const l=e==null?void 0:e.membershipToken;l&&w(p,l),st(()=>{vt("track","Upsell")});const{saleAction:c,stepPath:M,visitWebsite:R}=t.element.extra;if(!c)if(n.value.funnelNextStep){D();return}else throw new Error("Redirect not handled");if(n.value.orderFormVersion===2){const I=`_pl_${n.value.funnelId}`,E=localStorage.getItem(I);if(E){let x=JSON.parse(E);x.push(ae.value),Ae(I,JSON.stringify(x))}}else{const I=`_pl_v1_${n.value.funnelId}`,E=localStorage.getItem(I);if(E){let x=JSON.parse(E);x.push((r=(a=t==null?void 0:t.element.extra)==null?void 0:a.productId)==null?void 0:r.value),Ae(I,JSON.stringify(x))}}switch(c.value){case"url":if(R&&R.value&&R.value.url){ee(R.value);break}else throw new Error("Redirect not handled");case"step-path":if(M&&M.value){D(M.value);break}else throw new Error("Redirect not handled");default:if(n.value.funnelNextStep){D();break}else throw new Error("Redirect not handled")}}catch{alert(`Order successfully placed! 
 However, Something went wrong while displaying this webpage, please contact the seller.`),u.value=!1;return}}const ne=async()=>{var r;let e=localStorage.getItem("_ud");e&&(e=JSON.parse(e));const a=e==null?void 0:e.customer_id;if(!a){f.value="Contact not found!";return}if(j.value&&!L.value){F.value="Invalid Captcha!",g.value=!1,u.value=!1;return}if(m.value=await yt({contactId:a,domain:n.value.domain,pageUrl:n.value.pageUrl,locationId:p,productPreviewList:[{_id:P,qty:1}],store:n.value,subType:ft.UPSELL,traceId:e==null?void 0:e.traceId,reCaptchaToken:L.value}),L.value=void 0,(r=m.value)!=null&&r.error){m.value.status===429&&(j.value=!0),f.value=m.value.message??"Error creating order!",g.value=!1,u.value=!1;return}};async function Ye(){var e,a;try{if(!P)throw new Error("No product Id found for initiating stripe payment");if(f.value="",await ne(),!m.value||(e=m.value)!=null&&e.error)return;const r={altId:p,altType:"location",orderId:m.value.order._id,reCaptchaToken:L.value},o=await C.initiateStripePayment(r);if(!o.success){f.value=o.message||"We're sorry, but something went wrong. Please try again.";return}const{clientSecret:l,paymentMethodId:c}=o;if(l){const q=await ye.value.confirmCardPayment(l,{payment_method:c,setup_future_usage:"off_session"});if(q.error){console.error("Failed to confirm card payment!",q.error),q.error.message&&alert(q.error.message);return}}const{orderId:M,paymentIntentId:R,subscriptionId:I,invoiceId:E,subId:x,txnId:et}=o,tt={altId:p,altType:"location",orderId:M,paymentIntentId:R,subscriptionId:I,invoiceId:E,isAuth:!1,subId:x,txnId:et,attribution:{eventData:K(),sessionId:J(p),sessionFingerprint:X(p)}},z=await C.verifyStripePayment(tt);if(console.log("verifyPaymentResponseData",z),!z.success){f.value=z.message||"We're sorry, but something went wrong. Please try again.";return}await G(z)}catch(r){if(((a=r==null?void 0:r.response)==null?void 0:a.status)===429){j.value=!0,g.value=!1,u.value=!1;return}f.value=H(r),u.value=!1,console.error(r)}}async function ge(e){var a,r,o;try{if(!P)throw new Error("No product Id found for initiating stripe payment");if(g.value=!0,f.value="",await ne(),!m.value||(a=m.value)!=null&&a.error)return;let l;if((r=m.value)!=null&&r.order._id){l={altId:p,altType:"location",orderId:(o=m.value)==null?void 0:o.order._id,attribution:{eventData:K(),sessionId:J(p),sessionFingerprint:X(p)}};let c;switch(e){case se:{c=await C.authorizeNetOrderPayment(l);break}case le:{c=await C.nmiOrderPayment(l);break}default:console.log("Invalid payment provider");break}if(console.log(c),g.value=!1,!c.success){f.value=c.message||"We're sorry, but something went wrong. Please try again.";return}await G({membershipPurchase:c.membershipPurchase,membershipToken:c.membershipToken})}}catch(l){u.value=!1,g.value=!1,console.log(l),f.value=H(l)}}async function Ze(){if(P)try{const e=mt(),a={...K(),fbEventId:e},r=J(p),o=X(p),l=await De.funnelPayment({fingerprint:B("msgsndr_id").value,productList:[P],locationId:p,funnelId:je,stepId:Ge,pageId:ze,domain:n.value.domain,pageUrl:n.value.pageUrl,source:"payment_button",submissionType:3,eventData:a,sessionId:r,sessionFingerprint:o,_mp:B("_mp").value});await G(l)}catch(e){console.log(e)}finally{u.value=!0}}async function _e(e,a){var r,o;try{if(!P)throw new Error("No product Id found for initiating paypal payment");if(g.value=!0,S.value="",f.value="",await ne(),!m.value||(r=m.value)!=null&&r.error)return;const l={altId:p,altType:"location",orderId:(o=m.value)==null?void 0:o.order._id},c=await C.initiatePayPalPayment(l);if(!c.success){f.value=c.message||"We're sorry, but something went wrong. Please try again.";return}if(a.subscription&&c.plan_id)return a.subscription.create(c);if(a.order&&c.id)return c.id}catch(l){console.log(l.message),S.value=H(l),g.value=!1}}async function be(e){try{if(!P)throw new Error("No product Id found for paypal payment");g.value=!0,S.value="",f.value="";const a={facilitatorAccessToken:e.facilitatorAccessToken,orderId:m.value.order._id,paypalOrderId:e.orderID,altId:p,altType:"location",attribution:{eventData:K(),sessionId:J(p),sessionFingerprint:X(p)}};e.payerID&&(a.paypalPayerId=e.payerID),e.subscriptionID&&(a.paypalSubscriptionId=e.subscriptionID);const r=await C.verifyPayPalPayment(a);if(console.log("verifyPaymentResponseData",r),!r.success){f.value=r.message||"We're sorry, but something went wrong. Please try again.";return}const o=B("provider");o.value="pp",await G(r)}catch(a){console.error(a.message),S.value=H(a),g.value=!1}}function we(){g.value=!1,S.value="Transaction has been cancelled by the user!"}function Qe(){let e="";const{action:{value:a}}=t.element.extra;switch(a){case h.CLICK_TO_CALL:{let r=t.element.extra[V.PHONE_NUMBER].value;r=r.replace("tel:",""),e=`tel:${r}`;break}case h.CLICK_TO_SMS:{let r=t.element.extra[V.PHONE_NUMBER].value;r=r.replace("sms:",""),e=`sms:${r}`;break}case h.GO_TO_URL:{const{visitWebsite:{value:r}}=t.element.extra,{url:o,newTab:l}=r;e=o,e=oe(e),e&&!e.startsWith("#")&&!/^https?:/.test(e)&&(e=`https://${e}`),fe.value=l?"_blank":"";break}case h.GO_TO_STEP:{const r=t.element.extra.stepPath.value;e=Ve(r);break}}return e}return(e,a)=>{const r=Et,o=xt,l=kt;return y(),_(ot,null,[te.value?(y(),_("a",{key:0,id:`${s.element.id}_btn`,href:me.value,target:fe.value,class:Oe([s.classStyles,"text-center"]),onClick:Je,"aria-label":he()},[k("span",{style:U(u.value?"visibility: hidden;":""),class:"main-heading-group"},[s.element.extra.icon!==""?(y(),_("span",Ot)):b("",!0),k("span",Lt,N($(T)),1),s.element.extra.icon!==""?(y(),_("span",Rt)):b("",!0)],4),s.element.extra.subText&&s.element.extra.subText.value?(y(),_("span",{key:0,style:U(u.value?"visibility: hidden;":""),class:"sub-heading-group text-xs font-sans"},[k("span",Nt,N($(O)),1)],4)):b("",!0)],10,Tt)):b("",!0),j.value?(y(),_("section",Ct,[Le(r,{onExpired:a[0]||(a[0]=()=>L.value=""),onVerify:He}),F.value?(y(),_("p",At,N(F.value),1)):b("",!0)])):b("",!0),te.value?b("",!0):Re((y(),_("button",{key:2,disabled:u.value,id:`${s.element.id}_btn`,style:U(u.value?"cursor: default;":""),class:Oe([s.classStyles]),onClick:Xe,"aria-label":he()},[k("div",{style:U(u.value?"visibility: hidden;":""),class:"main-heading-group"},[s.element.extra.icon!==""?(y(),_("div",Ft)):b("",!0),k("div",Mt,N($(T)),1),s.element.extra.icon!==""?(y(),_("div",$t)):b("",!0)],4),s.element.extra.subText&&s.element.extra.subText.value?(y(),_("div",{key:0,style:U(u.value?"visibility: hidden;":""),class:"text-xs font-sans"},[k("div",Ut,N($(O)),1)],4)):b("",!0),Re(k("div",Bt,[Le(ct,{loading:u.value,color:"rgb(255, 255, 255)",size:"30px"},null,8,["loading"])],512),[[Ne,u.value]])],14,Dt)),[[Ne,!re.value]]),re.value&&W.value?(y(),_("div",Vt,[$(qe)?(y(),Ce(o,{key:0,initiatePaypalPayment:_e,onApprovePaypalPayment:be,onCancelPaypalPayment:we,paypalErrorMsg:S.value,processingPayment:g.value,currency:W.value},null,8,["paypalErrorMsg","processingPayment","currency"])):(y(),Ce(l,{key:1,initiatePaypalPayment:_e,onApprovePaypalPayment:be,onCancelPaypalPayment:we,paypalErrorMsg:S.value,processingPayment:g.value,currency:W.value},null,8,["paypalErrorMsg","processingPayment","currency"]))])):b("",!0),f.value?(y(),_("div",Wt,N(f.value),1)):b("",!0)],64)}}});export{sa as default};
